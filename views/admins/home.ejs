<% include ../shared/admin_navbar %>
<div class = "uk-grid">
	<div class = "uk-width-1-3">
		<div class = "uk-pannel uk-panel-box uk-panel-box-secondary">
			<h3 class = "uk-panel-title">Next Appointment for each Client</h3>
			<% for (var i = 0; i < dashboard.clientTimes.length; i++) { %>
				<div><p><%= dashboard.clientTimes[i].client_name + " " + dashboard.clientTimes[i].appointment_date +
					" " + dashboard.clientTimes[i].start_time + " - " + dashboard.clientTimes[i].end_time%></p><a href="mailto:<%= dashboard.clientTimes[i].client_email %>" class="uk-button uk-button-primary">Email</a>
				</div>
			<% } %>
		</div>
	</div>

	<div class = "uk-width-1-3">
		<div class = "uk-panel uk-panel-box uk-panel-box-secondary">
			<div class = "day-calendar"></div>
		</div>
	</div>

	<div class = "uk-width-1-3">
		<div class = "uk-panel uk-panel-box uk-panel-box-secondary">
			<h3 class = "uk-panel-title"> Appointments needing confirmation</h3>
			<% if(dashboard.appointmentConfirms.length > 0){ %>
				<% for (var i = 0; i < dashboard.appointmentConfirms.length; i++) { %>
					<div><p><%= dashboard.appointmentConfirms[i].client_name + " " + dashboard.appointmentConfirms[i].appointment_date +
						" " + dashboard.appointmentConfirms[i].start_time + " - " + dashboard.appointmentConfirms[i].end_time%></p><a class="uk-button uk-button-primary confirm-yes">Confirm,Yes?</a><a class= "uk-button uk-button-danger confirm-no">Confirm, No?</a>
					</div>
				<% } %>
			<% } else { %>
				<div><p>No Appointments Need Confirmation</p></div>
			<% } %>
		</div>
	</div>

</div>









<script>
	$(function(){
		var date = null
		$.post('/dailyschedule', function(data){
				var dailyTimes = $.map(data.times, function(session){ //deal with error of not being able to display calendar 
					// when no appointments are available.
					return {
				 						id : session.appointmentId,
				 						start : prettifyDate(session.appointmentDate,session.startTime),
				 						end : prettifyDate(session.appointmentDate,session.endTime),
				 						title : session.clientName == null ? "Open Slot" : session.clientName,
				 						allDay : false
		 						}
				})
				$(".day-calendar").fullCalendar({
						defaultView:'agendaDay',
		 				events: dailyTimes
					});
		});
			
		function prettifyDate(date,time){
			var formattedDate = date.match(/^(\d{4}-\d\d-\d\d)/)
			return formattedDate[1] + " " + time
		}					
 });
</script>